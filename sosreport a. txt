Excellente question ğŸ‘Œ â€” câ€™est un point clÃ© en troubleshooting Linux professionnel : savoir si on peut rÃ©cupÃ©rer un sosreport â€œavant incidentâ€ pour comparer avec celui pris â€œaprÃ¨s incidentâ€.

Voici toutes les possibilitÃ©s selon les cas ğŸ‘‡


---

ğŸ§  1ï¸âƒ£ Comprendre le principe

sosreport nâ€™est pas gÃ©nÃ©rÃ© automatiquement par le systÃ¨me :
il ne prend une â€œphotoâ€ de lâ€™Ã©tat du systÃ¨me que quand tu exÃ©cutes manuellement la commande :

sosreport

ğŸ‘‰ Donc, tu ne peux pas recrÃ©er un sosreport dâ€™avant incident Ã  moins quâ€™il ait Ã©tÃ© :

dÃ©jÃ  gÃ©nÃ©rÃ© avant (ex. routine hebdo, patching, audit, etc.),

ou quâ€™il soit disponible sur un backup, satellite, ou NFS partagÃ©.



---

ğŸ§© 2ï¸âƒ£ VÃ©rifie sâ€™il existe un sosreport plus ancien sur le serveur

Les sosreports sont souvent stockÃ©s ici :

/var/tmp/

ou parfois :

/root/

ou

/tmp/

â¤ Commande pour les lister :

ls -lh /var/tmp/sosreport* /root/sosreport* /tmp/sosreport* 2>/dev/null

Exemple de rÃ©sultat :

-rw------- 1 root root 180M Oct 17 10:12 /var/tmp/sosreport-server1-2025-10-17-10-12-22.tar.xz
-rw------- 1 root root 190M Oct 22 15:30 /var/tmp/sosreport-server1-2025-10-22-15-30-12.tar.xz

â¡ï¸ Ici, celui du 17 octobre est ton â€œavant incidentâ€,
et celui du 22 octobre est ton â€œaprÃ¨s incidentâ€.


---

ğŸ§® 3ï¸âƒ£ Identifier la date exacte de chaque sosreport

stat /var/tmp/sosreport-*.tar.xz | grep Modify

ou plus lisible :

ls -lh --time-style=long-iso /var/tmp/sosreport*


---

âš™ï¸ 4ï¸âƒ£ Si aucun sosreport avant incident nâ€™existe

Tu as 3 options possibles selon ton environnement :

ğŸ”¸ a. Si tu utilises Red Hat Satellite

Chaque action (ex. patching, compliance, inventory) peut collecter des sosreports automatiques.
VÃ©rifie sur ton Satellite (6.x ou 7.x) :

/var/lib/pulp/

ou depuis lâ€™interface Satellite â†’ Hosts â†’ Reports â†’ sosreports
Tu peux parfois y tÃ©lÃ©charger un rapport ancien.


---

ğŸ”¸ b. Si tu as sos-collector

sos-collector permet de collecter les sosreports de plusieurs serveurs et les archiver :

sos collect --cluster-name <nom>

â¡ï¸ Les anciens rapports sont stockÃ©s sur le nÅ“ud collecteur (gÃ©nÃ©ralement /var/tmp/sos-collector-*).


---

ğŸ”¸ c. Si tu as un backup systÃ¨me (NFS, snapshot, sauvegarde Commvault, etc.)

Cherche dans le backup du rÃ©pertoire :

/var/tmp/

ou

/root/

pour extraire le sosreport dâ€™une date antÃ©rieure Ã  lâ€™incident.


---

ğŸ§° 5ï¸âƒ£ Une fois rÃ©cupÃ©rÃ© â†’ comparaison

Si tu as :

sosreport-server1-2025-10-17-10-12.tar.xz (avant incident)

sosreport-server1-2025-10-22-15-30.tar.xz (aprÃ¨s incident)


â¡ï¸ Compare-les avec :

sosreport-analyzer ./sosreport-server1-2025-10-17-10-12/ ./sosreport-server1-2025-10-22-15-30/

Tu verras les changements de configuration, de kernel, ou dâ€™erreurs apparues aprÃ¨s.


---

ğŸ§© 6ï¸âƒ£ Si tu veux automatiser la crÃ©ation â€œprÃ©ventiveâ€ de sosreport

Je te conseille de planifier une tÃ¢che cron hebdomadaire pour gÃ©nÃ©rer un sosreport avant toute opÃ©ration critique :

cat <<EOF > /etc/cron.weekly/sosreport_auto
#!/bin/bash
mkdir -p /var/tmp/sosarchive
sosreport --batch --tmp-dir /var/tmp/sosarchive > /dev/null 2>&1
find /var/tmp/sosarchive -type f -mtime +14 -delete
EOF
chmod +x /etc/cron.weekly/sosreport_auto

âœ… Cela crÃ©e automatiquement un sosreport chaque semaine et supprime ceux de plus de 14 jours.


---

âœ… RÃ©sumÃ©

Cas	Action

DÃ©jÃ  gÃ©nÃ©rÃ© avant	Chercher dans /var/tmp, /root, /tmp
Satellite / Capsule	TÃ©lÃ©charger depuis interface ou /var/lib/pulp/
Sos-collector	VÃ©rifier /var/tmp/sos-collector-*
Backup	Restaurer le fichier depuis sauvegarde
Rien dâ€™existant	Planifier une gÃ©nÃ©ration automatique (cron)



---

Souhaites-tu que je te crÃ©e un script automatique de rÃ©cupÃ©ration + comparaison entre le dernier sosreport disponible et celui â€œaprÃ¨s incidentâ€ (avec rÃ©sumÃ© CPU, FS, network, logs) ?